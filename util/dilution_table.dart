class DilutionTable {
  // Assuming a half life of 90 minutes for Levodopa: C = 0.5 ^ (t / 90) 
  // (time in minutes) and approximately zero after 10 hours
  Map<int, double> cByT = {
    0: 1,
    15: 0.8908987181,
    30: 0.793700526,
    45: 0.7071067812,
    60: 0.6299605249,
    75: 0.5612310242,
    90: 0.5,
    105: 0.4454493591,
    120: 0.396850263,
    135: 0.3535533906,
    150: 0.3149802625,
    165: 0.2806155121,
    180: 0.25,
    195: 0.2227246795,
    210: 0.1984251315,
    225: 0.1767766953,
    240: 0.1574901312,
    255: 0.140307756,
    270: 0.125,
    285: 0.1113623398,
    300: 0.09921256575,
    315: 0.08838834765,
    330: 0.07874506562,
    345: 0.07015387802,
    360: 0.0625,
    375: 0.05568116988,
    390: 0.04960628287,
    405: 0.04419417382,
    420: 0.03937253281,
    435: 0.03507693901,
    450: 0.03125,
    465: 0.02784058494,
    480: 0.02480314144,
    495: 0.02209708691,
    510: 0.0196862664,
    525: 0.0175384695,
    540: 0.015625,
    555: 0.01392029247,
    570: 0.01240157072,
    585: 0.01104854346,
    600: 0.009843133202,
  };

  double cAfter(Duration time) {
    return cAfterMinutes(time.inMinutes);
  }

  double cAfterMinutes(int t) {
    if (t < 0 || t > 615) return 0.0;
    int closestKey = cByT.keys
        .where((key) => key <= t)
        .fold(0, (prev, curr) => curr > prev ? curr : prev);
    return cByT[closestKey]!;
  }
}
